require 'test_helper'

class DocumentsControllerTest < ActionController::TestCase

  include Devise::TestHelpers

  def setup
    sign_in users(:one)
    @document = Document.create(:user_id => 1, :name => 'untitled')
    request = {
      :delete_nodes=>",,,30950,30951,30952,30953,30954",
      :name=>"untitled",
      :html=>'<p id=\"node_2\" class=\"changed outline_node\">new</p>\n<p id=\"node_3\" class=\"changed outline_node active\">doc - asdfssdf</p>\n<p id=\"node_4\" class=\"changed outline_node\">with a few nodes</p>\n<p id=\"node_5\" class=\"changed outline_node active\">and a&nbsp; - list:</p>\n<ul>\n<li id=\"node_6\" class=\"changed outline_node\">aasdf</li>\n<li id=\"node_7\" class=\"changed outline_node active\">asd -asdf</li>\n<li id=\"node_8\" class=\"changed outline_node\">fasd</li>\n<li id=\"node_9\" class=\"changed outline_node active\">fsd - sdf</li>\n</ul>',
      :id=>@document.id,
      :new_nodes=>"true"
    }
    Document.update(request, 1)
    lines = Line.find_all_by_document_id(@document.id)
  end

  test "simple four" do
    sign_in users(:one)
    document = Document.create(:user_id => 1, :name => 'untitled')
    request = {
      :delete_nodes=>",,,30950,30951,30952,30953,30954",
      :name=>"untitled",
      :html=>'<p id=\"node_2\" class=\"changed outline_node\">new</p>\n<p id=\"node_3\" class=\"changed outline_node active\">doc - asdfssdf</p>\n<p id=\"node_4\" class=\"changed outline_node\">with a few nodes</p>\n<p id=\"node_5\" class=\"changed outline_node active\">and a&nbsp; - list:</p>\n<ul>\n<li id=\"node_6\" class=\"changed outline_node\">aasdf</li>\n<li id=\"node_7\" class=\"changed outline_node active\">asd -asdf</li>\n<li id=\"node_8\" class=\"changed outline_node\">fasd</li>\n<li id=\"node_9\" class=\"changed outline_node active\">fsd - sdf</li>\n</ul>',
      :id=>document.id,
      :new_nodes=>"true"
    }
    Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 4)
  end

  test "augment" do
    add_node_request = {
       :id => @document.id,
       :html => '<p id=\"node_2\" class=\"outline_node\">new</p>\n<p id=\"node_3\" class=\"changed outline_node active\">doc - asdfssdf</p>\n<p id=\"node_4\" class=\"changed outline_node\">with a few nodes</p>\n<p id=\"node_10\" class=\"changed outline_node active\">asd - asd</p>\n<p id=\"node_5\" class=\"changed outline_node active\">and a&nbsp; - list:</p>\n<ul>\n<li id=\"node_6\" class=\"changed outline_node\">aasdf</li>\n<li id=\"node_7\" class=\"changed outline_node active\">asd -asdf</li>\n<li id=\"node_8\" class=\"changed outline_node\">fasd</li>\n<li id=\"node_9\" class=\"changed outline_node active\">fsd - sdf</li>\n</ul>',
       :name => 'untitled',
       :delete_nodes => nil}
    lines = Line.find_all_by_document_id(@document.id)
    assert(lines.length == 4)
    @document = Document.update(add_node_request, 1)
    lines = Line.find_all_by_document_id(@document.id)
    assert(lines.length == 5)
  end

  test "deactivate" do
    sign_in users(:one)
    request = {
      :delete_nodes=>"",
      :name=>"untitled",
      :html=>'<p id=\"node_2\" class=\"changed outline_node\">new</p>\n<p id=\"node_3\" class=\"changed outline_node\">doc - asdfssdf</p>\n<p id=\"node_4\" class=\"changed outline_node\">with a few nodes</p>\n<p id=\"node_5\" class=\"changed outline_node active\">and a&nbsp; - list:</p>\n<ul>\n<li id=\"node_6\" class=\"changed outline_node\">aasdf</li>\n<li id=\"node_7\" class=\"changed outline_node active\">asd -asdf</li>\n<li id=\"node_8\" class=\"changed outline_node\">fasd</li>\n<li id=\"node_9\" class=\"changed outline_node active\">fsd - sdf</li>\n</ul>',
      :id=>@document.id,
      :new_nodes=>"true"}
    lines = Line.find_all_by_document_id(@document.id)
    assert(lines.length == 4)
    Document.update(request, 1)
    lines = Line.find_all_by_document_id(@document.id)
    assert(lines.length == 3)
  end

#  test "new IE doc" do
#    document = Document.create(:user_id => @user_id, :name => 'untitled')
#    request = {
#       :id => document.id,
#       :html => "<BODY id=node_0 line_id=\"413\">\r\n<UL>\r\n<LI id=node_16 class=outline_node line_id changed=\"1\" parent=\"node_0\" active=\"true\">a</LI>\r\n<LI id=node_17 class=outline_node line_id changed=\"1\" parent=\"node_0\" active=\"true\">b \r\n<UL>\r\n<LI id=node_18 class=outline_node line_id changed=\"1\" active=\"true\" parent=\"node_17\">c - d</LI></UL></LI></UL></BODY>",
#       :name => 'untitled',
#       :delete_nodes => nil,
#       :new_nodes => 'true'}
#    document = Document.update(request, @user_id)
#    lines = Line.find_all_by_document_id(document.id)
#    assert(lines.length == 3)
#  end
#
#  test "error" do
#    sign_in users(:one)
#    document = Document.create(:user_id => 1, :name => 'untitled')
#    request = {
#      :delete_nodes=>"",
#      :name=>"untitled",
#      :html=>"<body line_id=\"30640\" id=\"node_0\"><ul changed=\"1\"><li parent=\"node_0\" class=\"outline_node\" line_id=\"\" changed=\"1\" active=\"true\" id=\"node_373\">a<br><ul changed=\"1\"><li parent=\"node_373\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_470\" active=\"true\"><br><ul changed=\"1\"><li parent=\"\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_471\" active=\"true\"><br><ul><li parent=\"\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_472\" active=\"true\"><br><ul changed=\"1\"><li parent=\"\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_473\" active=\"true\"><br><ul><li parent=\"\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_474\" active=\"true\">s</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></body>",
#      :id=>document.id,
#      :new_nodes=>"true"}
#    Document.update(request, 1)
#    lines = Line.find_all_by_document_id(document.id)
#    assert(lines.length == 6)
#  end

  test "wikipedia" do
    sign_in users(:one)
    document = Document.create(:user_id => 1, :name => 'untitled')
    doc_id = document.id
    request = {
      :delete_nodes=>nil,
      :name=>"untitled",
      :html=>'<h1 id=\"firstHeading\" class=\"firstHeading\" style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0.1em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0px; padding-bottom: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #aaaaaa; width: auto; font-size: 1.6em; line-height: 1.2em; background-position: initial initial; background-repeat: initial initial;\">Thomcord</h1>\n<div id=\"bodyContent\" style=\"font-size: 0.8em; position: relative; width: 1327px; line-height: 1.5em;\">\n<div id=\"siteSub\" style=\"display: inline; font-size: 12px; font-weight: normal;\">From Wikipedia, the free encyclopedia</div>\n<div id=\"contentSub\" style=\"font-size: 10px; line-height: 1.2em; margin-top: 0px; margin-right: 0px; margin-bottom: 1.4em; margin-left: 1em; color: #7d7d7d; width: auto;\">&nbsp;</div>\n<table class=\"infobox biota\" style=\"font-size: 10px; color: black; background-color: #f9f9f9; margin-top: 0.5em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 1em; float: right; clear: right; text-align: left; line-height: 1.5em; width: 22em; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">\n<tbody>\n<tr><th class=\"variety\" style=\"vertical-align: top; text-align: center; font-size: 14px; background-color: #4b0082; color: #fff8dc;\" colspan=\"2\">Thomcord</th></tr>\n<tr><th style=\"vertical-align: top; text-align: center;\" colspan=\"2\"><span class=\"vernacular\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Grape\">Grape</a></span>&nbsp;(<em><span class=\"genus\">Vitis</span></em>)</th></tr>\n<tr>\n<td style=\"vertical-align: top; text-align: center;\" colspan=\"2\"><a class=\"image\" style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/File:Thomcord_grape_-_USDA_photo_01.jpg\"><img style=\"border-width: initial; border-color: initial; vertical-align: middle; border-style: none;\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Thomcord_grape_-_USDA_photo_01.jpg/215px-Thomcord_grape_-_USDA_photo_01.jpg\" alt=\"Several cluster of blue-black grapes hang from the vine\" width=\"215\" height=\"143\" /></a></td>\n</tr>\n<tr>\n<td style=\"vertical-align: top; text-align: center;\" colspan=\"2\">Thomcord grapes</td>\n</tr>\n<tr><th style=\"vertical-align: top;\">Color of berry skin</th>\n<td style=\"vertical-align: top;\">Blue-black</td>\n</tr>\n<tr><th style=\"vertical-align: top;\">Species</th>\n<td class=\"binominal\" style=\"vertical-align: top;\"><em><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Vitis_vinifera\">Vitis vinifera</a></em>&nbsp;x&nbsp;<em><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Vitis_labrusca\">Vitis labrusca</a></em></td>\n</tr>\n<tr><th style=\"vertical-align: top;\">Origin</th>\n<td style=\"vertical-align: top;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/California\">California</a></td>\n</tr>\n<tr><th style=\"vertical-align: top;\">Pedigree parent 1</th>\n<td style=\"vertical-align: top;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Sultana (grape)\" href=\"http://en.wikipedia.org/wiki/Sultana_(grape)\">Sultanina</a>&nbsp;(Thompson Seedless)</td>\n</tr>\n<tr><th style=\"vertical-align: top;\">Pedigree parent 2</th>\n<td style=\"vertical-align: top;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Concord (grape)\" href=\"http://en.wikipedia.org/wiki/Concord_(grape)\">Concord</a></td>\n</tr>\n<tr><th style=\"vertical-align: top;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"List of wine-producing regions\" href=\"http://en.wikipedia.org/wiki/List_of_wine-producing_regions\">Notable regions</a></th>\n<td style=\"vertical-align: top;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/San_Joaquin_Valley\">San Joaquin Valley</a>,&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/California\">California</a></td>\n</tr>\n<tr><th style=\"vertical-align: top;\">Hazards</th>\n<td style=\"vertical-align: top;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Uncinula necator\" href=\"http://en.wikipedia.org/wiki/Uncinula_necator\">powdery mildew</a>&nbsp;(tolerant)</td>\n</tr>\n<tr><th style=\"vertical-align: top;\">Breeder</th>\n<td style=\"vertical-align: top;\">Ramming, David W.<br />Tarailo, Ronald L.</td>\n</tr>\n<tr><th style=\"vertical-align: top;\">Breeding institute</th>\n<td style=\"vertical-align: top;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Agricultural_Research_Service\">Agricultural Research Service</a>(ARS), USDA</td>\n</tr>\n<tr><th style=\"vertical-align: top;\">Year of crossing</th>\n<td style=\"vertical-align: top;\">1983</td>\n</tr>\n</tbody>\n</table>\n<p id=\"node_3\" class=\"changed outline_node\" style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em;\"><strong>Thomcord</strong>&nbsp;is a&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Seedless fruit\" href=\"http://en.wikipedia.org/wiki/Seedless_fruit\">seedless</a>&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Table_grape\">table grape</a>&nbsp;variety and a&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Hybrid (biology)\" href=\"http://en.wikipedia.org/wiki/Hybrid_(biology)\">hybrid</a>&nbsp;of the popular Thompson Seedless or&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Sultana (grape)\" href=\"http://en.wikipedia.org/wiki/Sultana_(grape)\">Sultanina</a>&nbsp;grape (a&nbsp;<em><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Vitis_vinifera\">Vitis vinifera</a></em>&nbsp;variety) and&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Concord (grape)\" href=\"http://en.wikipedia.org/wiki/Concord_(grape)\">Concord grape</a>&nbsp;(a&nbsp;<em><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Vitis_labrusca\">Vitis labrusca</a></em>&nbsp;variety). Thomcord was developed in 1983 by Californian grape breeders working for the&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Agricultural_Research_Service\">Agricultural Research Service</a>&nbsp;(ARS), an agency of the&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/United_States_Department_of_Agriculture\">United States Department of Agriculture</a>(USDA), as part of a test to better understand a new seedless grape breeding procedure.</p>\n<p id=\"node_4\" class=\"changed outline_node\" style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em;\">Its aromatic, \"<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Vitis labrusca\" href=\"http://en.wikipedia.org/wiki/Vitis_labrusca\">labrusca</a>\" flavor is similar to that of Concord, but mellowed by the mild, sweet taste from Thompson Seedless. Thomcord grows well in hot, dry climates, ripens between late July and mid-August, and tolerates of&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Uncinula necator\" href=\"http://en.wikipedia.org/wiki/Uncinula_necator\">powdery mildew</a>. It is a productive variety, yielding an average of 15.1&nbsp;kg (33&nbsp;lb) of grapes per vine, but has produced as much as 30 to 32 kg (66 to 71 lb) per vine in grower trials. The berries weigh between 2.72 and 3.38 g (0.096 and 0.119 oz) and have a medium-thick, blue-black skin that adheres to the fruit, unlike Concord, which has a thick skin that can slip off the pulp easily. The&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Seedless fruit\" href=\"http://en.wikipedia.org/wiki/Seedless_fruit\">aborted seeds</a>&nbsp;in the fruit body are relatively small, but larger than those in Thompson Seedless.</p>\n<p id=\"node_5\" class=\"changed outline_node\" style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em;\">The plant is not&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Plant quarantine\" href=\"http://en.wikipedia.org/wiki/Plant_quarantine\">restricted</a>&nbsp;for propagation and distribution. Virus-free propagation material is available from the Foundation Plant Services (FPS) at the&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/University_of_California,_Davis\">University of California, Davis</a>, and its genetic material is archived at the&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/National_Plant_Germplasm_System\">National Plant Germplasm System</a>. After 17&nbsp;years of testing, it was declared ready for use in 2003. It is expected to appear in supermarkets, possibly as a specialty item.</p>\n<table id=\"toc\" class=\"toc\" style=\"font-size: 12px; color: black; background-color: #f9f9f9; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 5px;\">\n<tbody>\n<tr>\n<td>\n<div id=\"toctitle\" style=\"text-align: center;\">\n<h2 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: bold; margin-top: 0px; margin-right: 0px; margin-bottom: 0.6em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; width: auto; font-size: 12px; display: inline; border-width: initial; border-color: initial; background-position: initial initial; background-repeat: initial initial; border-style: none; padding: 0px;\">Contents</h2>\n&nbsp;<span class=\"toctoggle\" style=\"font-size: 12px;\">[<a id=\"togglelink\" class=\"internal\" style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord\">hide</a>]</span></div>\n<ul style=\"line-height: 1.5em; list-style-type: none; margin-top: 0.3em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; list-style-image: none; text-align: left; padding: 0px;\">\n<li id=\"node_6\" class=\"toclevel-1 tocsection-1 changed outline_node\" style=\"margin-bottom: 0.1em;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#Description\"><span class=\"tocnumber\">1</span>&nbsp;<span class=\"toctext\">Description</span></a>\n<ul style=\"line-height: 1.5em; list-style-type: none; margin-top: 0px; margin-right: 0px; margin-bottom: 0.5em; margin-left: 2em; list-style-image: none; text-align: left; padding: 0px;\">\n<li id=\"node_7\" class=\"toclevel-2 tocsection-2 changed outline_node\" style=\"margin-bottom: 0.1em;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#Production_details\"><span class=\"tocnumber\">1.1</span>&nbsp;<span class=\"toctext\">Production details</span></a></li>\n<li id=\"node_8\" class=\"toclevel-2 tocsection-3 changed outline_node\" style=\"margin-bottom: 0.1em;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#Vegetative_description\"><span class=\"tocnumber\">1.2</span>&nbsp;<span class=\"toctext\">Vegetative description</span></a></li>\n</ul>\n</li>\n<li id=\"node_9\" class=\"toclevel-1 tocsection-4 changed outline_node\" style=\"margin-bottom: 0.1em;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#History\"><span class=\"tocnumber\">2</span>&nbsp;<span class=\"toctext\">History</span></a></li>\n<li id=\"node_10\" class=\"toclevel-1 tocsection-5 changed outline_node\" style=\"margin-bottom: 0.1em;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#Availability\"><span class=\"tocnumber\">3</span>&nbsp;<span class=\"toctext\">Availability</span></a></li>\n<li id=\"node_11\" class=\"toclevel-1 tocsection-6 changed outline_node\" style=\"margin-bottom: 0.1em;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#See_also\"><span class=\"tocnumber\">4</span>&nbsp;<span class=\"toctext\">See also</span></a></li>\n<li id=\"node_12\" class=\"toclevel-1 tocsection-7 changed outline_node\" style=\"margin-bottom: 0.1em;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#References\"><span class=\"tocnumber\">5</span>&nbsp;<span class=\"toctext\">References</span></a></li>\n</ul>\n</td>\n</tr>\n</tbody>\n</table>\n<h2 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0.6em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #aaaaaa; width: auto; font-size: 19px; background-position: initial initial; background-repeat: initial initial;\"><span class=\"editsection\" style=\"float: right; margin-left: 5px; font-size: 13px;\">[<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Edit section: Description\" href=\"http://en.wikipedia.org/w/index.php?title=Thomcord&amp;action=edit&amp;section=1\">edit</a>]</span><span id=\"Description\" class=\"mw-headline\">Description</span></h2>\n<p id=\"node_13\" class=\"changed outline_node active\" style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em;\">Thomcord grape - is a hybrid of Thompson Seedless grape (<em><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Vitis_vinifera\">Vitis vinifera</a></em>, or Sultanina), which is popular in supermarkets during the summer, and seeded Concord grape (<em><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Vitis_labrusca\">Vitis labrusca</a></em>), commonly used to make grape juice and jelly.<sup id=\"cite_ref-2008Ramming_0-0\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup><sup id=\"cite_ref-2006_USDA_1-0\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2006_USDA-1\"><span>[</span>2<span>]</span></a></sup>&nbsp;It is a plump, juicy, seedless&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Table_grape\">table grape</a>&nbsp;and is slightly firmer than Concord. Thomcord has a blue-black skin with medium thickness and a whitish bloom.<sup id=\"cite_ref-2008Ramming_0-1\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup><sup id=\"cite_ref-2006_USDA_1-1\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2006_USDA-1\"><span>[</span>2<span>]</span></a></sup><sup id=\"cite_ref-2004FPS_2-0\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2004FPS-2\"><span>[</span>3<span>]</span></a></sup>&nbsp;Unlike Concord, whose tough skin separates easily from the fruit, Thomcord has a more edible skin that clings to the flesh, much like Thompson Seedless.<sup id=\"cite_ref-2008Ramming_0-2\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup><sup id=\"cite_ref-2006_Sacramento_Bee_3-0\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2006_Sacramento_Bee-3\"><span>[</span>4<span>]</span></a></sup>&nbsp;It has an aromatic flavor, similar to the Concord in taste (\"<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Vitis labrusca\" href=\"http://en.wikipedia.org/wiki/Vitis_labrusca\">labrusca</a>\"), though lighter due to the sweet, mild taste from Thompson Seedless.<sup id=\"cite_ref-2008Ramming_0-3\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup><sup id=\"cite_ref-2006_USDA_1-2\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2006_USDA-1\"><span>[</span>2<span>]</span></a></sup><sup id=\"cite_ref-2006_Sacramento_Bee_3-1\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2006_Sacramento_Bee-3\"><span>[</span>4<span>]</span></a></sup></p>\n<p id=\"node_14\" class=\"changed outline_node active\" style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em;\">Thomcord - is suitable for hot, dry growing conditions, more so than Concord and other Concord seedless types. Its adaptability to hot dry climates was derived from Thompson Seedless. It grows well in&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Wine Country (California)\" href=\"http://en.wikipedia.org/wiki/Wine_Country_(California)\">California\'s vineyards</a>, particularly the&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/San_Joaquin_Valley\">San Joaquin Valley</a>,<sup id=\"cite_ref-2008Ramming_0-4\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup>&nbsp;just like Thompson Seedless.<sup id=\"cite_ref-2006_USDA_1-3\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2006_USDA-1\"><span>[</span>2<span>]</span></a></sup>&nbsp;The plant is tolerant of (but not resistant to)&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Uncinula necator\" href=\"http://en.wikipedia.org/wiki/Uncinula_necator\">powdery mildew</a>,<sup id=\"cite_ref-2004FPS_2-1\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2004FPS-2\"><span>[</span>3<span>]</span></a></sup><sup id=\"cite_ref-2006_Sacramento_Bee_3-2\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2006_Sacramento_Bee-3\"><span>[</span>4<span>]</span></a></sup>and is less susceptible to the&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Fungus\">fungus</a>&nbsp;than&nbsp;<a class=\"new\" style=\"text-decoration: none; color: #ba0000; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Ruby Seedless (grape) (page does not exist)\" href=\"http://en.wikipedia.org/w/index.php?title=Ruby_Seedless_(grape)&amp;action=edit&amp;redlink=1\">Ruby Seedless</a>, but more susceptible than&nbsp;<a class=\"new\" style=\"text-decoration: none; color: #ba0000; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Mars (grape) (page does not exist)\" href=\"http://en.wikipedia.org/w/index.php?title=Mars_(grape)&amp;action=edit&amp;redlink=1\">Mars</a>,&nbsp;<a class=\"new\" style=\"text-decoration: none; color: #ba0000; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Venus (grape) (page does not exist)\" href=\"http://en.wikipedia.org/w/index.php?title=Venus_(grape)&amp;action=edit&amp;redlink=1\">Venus</a>,&nbsp;<a class=\"new\" style=\"text-decoration: none; color: #ba0000; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Niabell (grape) (page does not exist)\" href=\"http://en.wikipedia.org/w/index.php?title=Niabell_(grape)&amp;action=edit&amp;redlink=1\">Niabell</a>, and&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Cayuga_White\">Cayuga White</a>&nbsp;varieties.<sup id=\"cite_ref-2008Ramming_0-5\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup>&nbsp;The fungus can affect its&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Leaf\" href=\"http://en.wikipedia.org/wiki/Leaf\">leaves</a>,&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Plant stem\" href=\"http://en.wikipedia.org/wiki/Plant_stem\">stems</a>,&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Rachis\">rachis</a>&nbsp;(stem of the grape cluster), and&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Berry\" href=\"http://en.wikipedia.org/wiki/Berry\">berries</a>. The grape ripens in the summer (mid-season), between late July and mid-August.<sup id=\"cite_ref-2006_USDA_1-4\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2006_USDA-1\"><span>[</span>2<span>]</span></a></sup><sup id=\"cite_ref-NVRC_4-0\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-NVRC-4\"><span>[</span>5<span>]</span></a></sup></p>\n<table class=\"wikitable\" style=\"font-size: 13px; color: black; margin-top: 1em; margin-right: auto; margin-bottom: 1em; margin-left: auto; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f9f9f9; border-collapse: collapse; width: 700pt; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid;\"><caption style=\"font-weight: bold;\">Comparison between the Thomcord and its pedigree parents<sup id=\"cite_ref-2008Ramming_0-6\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup><sup id=\"cite_ref-2006_Sacramento_Bee_3-3\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2006_Sacramento_Bee-3\"><span>[</span>4<span>]</span></a></sup></caption>\n<tbody>\n<tr><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f2f2f2; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">&nbsp;</th><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f2f2f2; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Color</th><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f2f2f2; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Skin type</th><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f2f2f2; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Seed type</th><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f2f2f2; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Aborted seed size</th><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f2f2f2; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Growing conditions</th><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f2f2f2; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Flavor profile</th></tr>\n<tr><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f2f2f2; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Thompson Seedless</th>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">White</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Adhering, thin</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Aborted</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Very small</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Hot, dry climate</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Mild &amp; sweet</td>\n</tr>\n<tr><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #f2f2f2; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Concord</th>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Blue</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Separable, thick &amp; tough</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Viable</td>\n<td class=\"table-na\" style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #ececec; color: #808080; vertical-align: middle; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\"><small>N/A</small></td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">High humidity</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">\"Foxy\"</td>\n</tr>\n<tr style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #ffdead; background-position: initial initial; background-repeat: initial initial;\"><th style=\"background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #ffdead; text-align: center; background-position: initial initial; background-repeat: initial initial; border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Thomcord</th>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Blue-black</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Adhering, medium thickness</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Aborted</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Small</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">Hot, dry climate</td>\n<td style=\"border-width: 1px; border-color: #aaaaaa; border-style: solid; padding: 0.2em;\">\"labrusca\", but mild &amp; sweet</td>\n</tr>\n</tbody>\n</table>\n<h3 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: bold; margin-top: 0px; margin-right: 0px; margin-bottom: 0.3em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: initial; border-bottom-style: none; border-bottom-color: initial; width: auto; font-size: 16px; background-position: initial initial; background-repeat: initial initial;\"><span class=\"editsection\" style=\"float: right; margin-left: 5px; font-size: 13px; font-weight: normal;\">[<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Edit section: Production details\" href=\"http://en.wikipedia.org/w/index.php?title=Thomcord&amp;action=edit&amp;section=2\">edit</a>]</span><span id=\"Production_details\" class=\"mw-headline\">Production details</span></h3>\n<p id=\"node_15\" class=\"changed outline_node active\" style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em;\">Thomcord - is a productive variety, with a yield comparable to Thompson Seedless. When two&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Canopy (grape)\" href=\"http://en.wikipedia.org/wiki/Canopy_(grape)#Cordon\">cordons</a>&nbsp;(arms) of the vines are&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Vine training\" href=\"http://en.wikipedia.org/wiki/Vine_training\">trained</a>&nbsp;horizontally on wires (\"<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Vine training\" href=\"http://en.wikipedia.org/wiki/Vine_training#Components_of_a_grapevine\">bilateral-trained</a>\") and are pruned to remove most of the previous year\'s growth (\"<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Vine training\" href=\"http://en.wikipedia.org/wiki/Vine_training#Components_of_a_grapevine\">spur-pruned</a>\") during the winter, it can produce up to 13&ndash;16 kg (29&ndash;35 lb) per vine, or an average of 15.1&nbsp;kg (33&nbsp;lb).<sup id=\"cite_ref-2008Ramming_0-7\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup><sup id=\"cite_ref-2004FPS_2-2\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2004FPS-2\"><span>[</span>3<span>]</span></a></sup>&nbsp;In 2002, cane-pruned vines of Thomcord were significantly more productive than&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Coronation (grape)\" href=\"http://en.wikipedia.org/wiki/Coronation_(grape)\">Sovereign Coronation</a>&nbsp;and were comparable to the Venus variety, averaging 21.3&nbsp;kg (47&nbsp;lb) per vine. Unlike Thompson Seedless, which has its cluster size thinned as a normal production practice, Thomcord\'s is not thinned because of its smaller cluster size. The grape clusters range in weight between 259 and 534 g (0.57 and 1.18 lb)<sup id=\"cite_ref-2008Ramming_0-8\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup>&nbsp;and average 340&nbsp;g (0.75&nbsp;lb),<sup id=\"cite_ref-2004FPS_2-3\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2004FPS-2\"><span>[</span>3<span>]</span></a></sup>&nbsp;have&nbsp;<a class=\"new\" style=\"text-decoration: none; color: #ba0000; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Grape cluster description (page does not exist)\" href=\"http://en.wikipedia.org/w/index.php?title=Grape_cluster_description&amp;action=edit&amp;redlink=1\">medium to slightly loose tightness</a>&nbsp;(or are \"well-filled\", meaning the individual&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Pedicel (botany)\" href=\"http://en.wikipedia.org/wiki/Pedicel_(botany)\">pedicels</a>&nbsp;are not easily visible), and have a conical shape with a small wing.<sup id=\"cite_ref-2008Ramming_0-9\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup><sup id=\"cite_ref-2004FPS_2-4\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2004FPS-2\"><span>[</span>3<span>]</span></a></sup></p>\n<p id=\"node_16\" class=\"changed outline_node\" style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em;\">Compared with Thompson Seedless, the berry weight and diameter of Thomcord are larger, but cluster tightness is similar. The berry length ranged between 18.2 and 18.3 mm (0.72 and 0.72 in) and the diameter ranged from 16.7 to 17.2 mm (0.66 to 0.68 in) in tests between 2001 and 2002. The berries weigh between 2.72 and 3.38 g (0.096 and 0.119 oz), averaging 2.85&nbsp;g (0.101&nbsp;oz) in 2002, which is on par with Venus, but heavier than Sovereign Coronation, and even more so than Thompson Seedless. The fruit\'s size has not been shown to increase appreciably by&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Girdling\">girdling</a>&nbsp;the vines or by applying&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Gibberellic_acid\">gibberellic acid</a>&nbsp;when the berries set.<sup id=\"cite_ref-2008Ramming_0-10\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup></p>\n<p id=\"node_17\" class=\"changed outline_node\" style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em;\">The aborted seeds of Thomcord are small, but in some years they can become sclerified (a thickening and&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Lignin\" href=\"http://en.wikipedia.org/wiki/Lignin\">lignification</a>&nbsp;of the walls of plant cells and the subsequent dying off of the&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Protoplast\" href=\"http://en.wikipedia.org/wiki/Protoplast\">protoplasts</a>), making them more noticeable inside the medium-soft flesh. There are usually two aborted seeds per berry, which averaged between 14 and 22.3&nbsp;mg in 2001 and 2002. This varied in comparison to Venus depending on the year and location, was comparable to the Sovereign Coronation, and was significantly smaller than the&nbsp;<a class=\"new\" style=\"text-decoration: none; color: #ba0000; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Sovereign Rose (grape) (page does not exist)\" href=\"http://en.wikipedia.org/w/index.php?title=Sovereign_Rose_(grape)&amp;action=edit&amp;redlink=1\">Sovereign Rose</a>&nbsp;and&nbsp;<a class=\"new\" style=\"text-decoration: none; color: #ba0000; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Saturn (grape) (page does not exist)\" href=\"http://en.wikipedia.org/w/index.php?title=Saturn_(grape)&amp;action=edit&amp;redlink=1\">Saturn</a>&nbsp;varieties. However, as with the other&nbsp;<a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; background-position: initial initial; background-repeat: initial initial;\" title=\"Cultivar\" href=\"http://en.wikipedia.org/wiki/Cultivar\">cultivars</a>, it was consistently larger than Thompson Seedless, which had the smallest aborted seeds.<sup id=\"cite_ref-2008Ramming_0-11\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal;\"><a style=\"text-decoration: none; color: #0645ad; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; white-space: nowrap; background-position: initial initial; background-repeat: initial initial;\" href=\"http://en.wikipedia.org/wiki/Thomcord#cite_note-2008Ramming-0\"><span>[</span>1<span>]</span></a></sup></p>\n</div>',
      :id=>document.id,
      :new_nodes=>"true"}
    Document.update(request, 1)
    lines = Line.find_all_by_document_id(doc_id)
    assert(lines.length == 3)
  end

  test "sequence 1" do
    sign_in users(:one)

    document = Document.create(:user_id => 1, :name => 'untitled')
    request = { :html=>"<p id=\"node_2\" class=\"changed outline_node\">a</p>\n<p id=\"node_3\" class=\"changed outline_node\">new</p>\n<p id=\"node_4\" class=\"changed outline_node\">co with</p>\n<p id=\"node_5\" class=\"changed outline_node active\">a - s</p>\n<p id=\"node_6\" class=\"changed outline_node active\">sdfa - tasd</p>\n<p id=\"node_7\" class=\"changed outline_node active\">thred - asdf</p>\n<p id=\"node_8\" class=\"changed outline_node\">cards</p>\n<ul>\n<li id=\"node_9\" class=\"changed outline_node\">that</li>\n<li id=\"node_10\" class=\"changed outline_node\">shoul</li>\n<li id=\"node_11\" class=\"changed outline_node\">be</li>\n<li id=\"node_12\" class=\"changed outline_node\">good!</li>\n</ul>",
                :name=>"test1",
                :id=>document.id,
                :delete_nodes=>"",
                :new_nodes=>"true"}
    updated_doc = Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 3)
    ids = Hash[*updated_doc.lines.map {|line| [line.domid, line.id]}.flatten]


    to_delete = ids["node_5"].to_s
    request = { :html=>"<p id=\"node_2\" class=\"changed outline_node\">a</p>\n<p id=\"node_3\" class=\"changed outline_node\">new</p>\n<p id=\"node_4\" class=\"changed outline_node\">co with</p>\n<p id=\"node_6\" class=\"changed outline_node active\">sdfa - tasd</p>\n<p id=\"node_7\" class=\"changed outline_node active\">thred - asdf</p>\n<p id=\"node_8\" class=\"changed outline_node\">cards</p>\n<ul>\n<li id=\"node_9\" class=\"changed outline_node\">that</li>\n<li id=\"node_10\" class=\"changed outline_node\">shoul</li>\n<li id=\"node_11\" class=\"changed outline_node\">be</li>\n<li id=\"node_12\" class=\"changed outline_node\">good!</li>\n</ul>",
                :name=>"test1",
                :id=>document.id,
                :delete_nodes=> to_delete,
                :new_nodes=>"true"}
    updated_doc = Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 2)

    request = { :html=>"<p id=\"node_2\" class=\"outline_node\">a</p>\n<p id=\"node_3\" class=\"outline_node\">new</p>\n<p id=\"node_4\" class=\"outline_node\">co with</p>\n<p id=\"node_6\" class=\"outline_node active\">sdfa - tasd</p>\n<p id=\"node_7\" class=\"outline_node active\">thred - asdf</p>\n<p id=\"node_8\" class=\"outline_node\">cards</p>\n<ul>\n<li id=\"node_9\" class=\"outline_node\">that</li>\n<li id=\"node_10\" class=\"outline_node\">shoul</li>\n<li id=\"node_11\" class=\"outline_node changed active\">be - asd</li>\n<ul>\n<li id=\"node_13\" class=\"outline_node changed active\">as - good!</li>\n</ul>\n</ul>",
                :name=>"test1",
                :id=>document.id,
                :delete_nodes=>"",
                :new_nodes=>"true"}
    updated_doc = Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 4)
    ids = Hash[*updated_doc.lines.map {|line| [line.domid, line.id]}.flatten]

    to_delete = ids["node_11"].to_s
    request = { :html=>"<p id=\"node_2\" class=\"outline_node\">a</p>\n<p id=\"node_3\" class=\"outline_node\">new</p>\n<p id=\"node_4\" class=\"outline_node\">co with</p>\n<p id=\"node_6\" class=\"outline_node active\">sdfa - tasd</p>\n<p id=\"node_7\" class=\"outline_node active\">thred - asdf</p>\n<p id=\"node_8\" class=\"outline_node\">cards</p>\n<ul>\n<li id=\"node_9\" class=\"outline_node\">that</li>\n<li id=\"node_10\" class=\"outline_node\">shoul</li>\n<ul>\n<li id=\"node_13\" class=\"outline_node changed active\">as - good!</li>\n</ul>\n</ul>",
                :name=>"test1",
                :id=>document.id,
                :delete_nodes=>to_delete,
                :new_nodes=>"true"}
    updated_doc = Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 3)
    ids = Hash[*updated_doc.lines.map {|line| [line.domid, line.id]}.flatten]
    dom_ids_set = Set.new(ids.keys)
    correct_ids = Set.new(["node_13","node_7","node_6"])
    assert(dom_ids_set == correct_ids)
  end

#  test "activate existing" do
#    sign_in users(:one)
#    document = Document.create(:user_id => 1, :name => 'untitled')
#
#    request1 = {
#      "delete_nodes"=>"",
#      "name"=>"lecture 7",
#      "html"=>"<body line_id=\"29534\" id=\"node_0\"><ul changed=\"1\"><li id=\"node_2\" line_id=\"29535\" changed=\"0\" class=\"outline_node\" active=\"false\" parent=\"node_0\">learning objectives:<ul changed=\"1\"><li line_id=\"29536\" changed=\"0\" class=\"outline_node\" parent=\"node_2\" id=\"node_4\">write octave function defined by its Taylor series using both a for loop and with vector operations</li><li line_id=\"29537\" changed=\"0\" class=\"outline_node\" parent=\"node_2\" id=\"node_5\">understand time and space trade-offs</li></ul></li><li line_id=\"29538\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_7\" active=\"true\">Tayler formual - f(x) =&nbsp;http://en.wikipedia.org/wiki/Taylor_series<ul changed=\"1\"><li line_id=\"29539\" changed=\"0\" class=\"outline_node\" parent=\"node_7\" id=\"node_9\" active=\"true\">nth der. of exp(n) - exp(n)</li></ul></li><li line_id=\"29540\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_12\" active=\"true\">hold on - plot on top of existing plot</li><li line_id=\"29541\" changed=\"1\" class=\"outline_node\" parent=\"node_0\" id=\"node_13\" active=\"true\">lambda function - exp3 = @(x) myexp(x,3)</li><li line_id=\"29542\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_14\" active=\"true\">bits of precision - error/log(d)</li><li line_id=\"29544\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_16\" active=\"true\">representing double precision in a computer - 1 bit for sign, 11 bits for exponent, 52 bits for the mantissa</li></ul></body>",
#      "id"=> document.id,
#      "new_nodes"=>"false"}
#
##    request2 = {
##      "delete_nodes"=>"",
##      "name"=>"lecture 7",
##      "html"=>"<body line_id=\"29534\" id=\"node_0\"><ul changed=\"1\"><li id=\"node_2\" line_id=\"29535\" changed=\"1\" class=\"outline_node\" active=\"true\" parent=\"node_0\">learning- objectives:<ul changed=\"1\"><li line_id=\"29536\" changed=\"0\" class=\"outline_node\" parent=\"node_2\" id=\"node_4\">write octave function defined by its Taylor series using both a for loop and with vector operations</li><li line_id=\"29537\" changed=\"0\" class=\"outline_node\" parent=\"node_2\" id=\"node_5\">understand time and space trade-offs</li></ul></li><li line_id=\"29538\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_7\" active=\"true\">Tayler formual - f(x) =&nbsp;http://en.wikipedia.org/wiki/Taylor_series<ul changed=\"1\"><li line_id=\"29539\" changed=\"0\" class=\"outline_node\" parent=\"node_7\" id=\"node_9\" active=\"true\">nth der. of exp(n) - exp(n)</li></ul></li><li line_id=\"29540\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_12\" active=\"true\">hold on - plot on top of existing plot</li><li line_id=\"29541\" changed=\"1\" class=\"outline_node\" parent=\"node_0\" id=\"node_13\" active=\"true\">lambda function - exp3 = @(x) myexp(x,3)</li><li line_id=\"29542\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_14\" active=\"true\">bits of precision - error/log(d)</li><li line_id=\"29544\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_16\" active=\"true\">representing double precision in a computer - 1 bit for sign, 11 bits for exponent, 52 bits for the mantissa</li></ul></body>",
##      "id"=> document.id,
##      "new_nodes"=>"false"}
#
#    Document.update(request1, 1)
#    lines = Line.find_all_by_document_id(document.id)
#    puts lines.length
#    assert(lines.length == 0)
#  end
end
