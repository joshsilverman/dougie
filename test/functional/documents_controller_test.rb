require 'test_helper'

class DocumentsControllerTest < ActionController::TestCase

  include Devise::TestHelpers

  def setup
    sign_in users(:one)
    @user_id = 1
    @requests = {:basic_outline => {
                 :html => '<body id="node_0"><p id="node_2" line_id="" changed="1" active="true" class="outline_node" parent="node_0">a</p><p line_id="" changed="1" active="true" class="outline_node" id="node_3" parent="node_0">b</p><p line_id="" active="true" changed="1" class="outline_node" id="node_4" parent="node_0">c</p><ul changed="1"><li line_id="" changed="1" active="true" class="outline_node" id="node_5" parent="node_0">1<ul><li line_id="" active="true" changed="1" class="outline_node" id="node_6" parent="node_5">2<ul><li line_id="" changed="1" class="outline_node" id="node_7" parent="node_6">3</li></ul></li></ul></li></ul></body>',
                 :name => 'untitled',
                 :delete_nodes => nil,
                 :new_nodes => 'true'}}
    @document = Document.create(:user_id => @user_id, :name => 'untitled')
    params = @requests[:basic_outline]
    params[:id] = @document.id
    @document = Document.update(params, @user_id)
    node_ids = @requests[:basic_outline][:html].scan(/id="node_(\d+)"/)
    @max_node_id =  node_ids.max[0].to_i
  end

  test "simple empty" do
    sign_in users(:one)
    document = Document.create(:user_id => 1, :name => 'untitled')
    request = {
      :delete_nodes=>",,,30950,30951,30952,30953,30954",
      :name=>"untitled",
      :html=>'<body line_id=\"30640\" id=\"node_0\"><p id="node_2" line_id="" changed="1" class="outline_node" parent="node_0">a</p></body>',
      :id=>document.id,
      :new_nodes=>"true"
    }
    Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 0)
  end

  test "simple not empty" do
    sign_in users(:one)
    document = Document.create(:user_id => 1, :name => 'untitled')
    request = {
      :delete_nodes=>"",
      :name=>"untitled",
      :html=>'<body line_id=\"30640\" id=\"node_0\"><p id="node_2" line_id="" changed="1" active="true" class="outline_node" parent="node_0">a</p></body>',
      :id=>document.id,
      :new_nodes=>"true"}
    Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 1)
  end

  test "augment" do
    add_node_request = {
       :id => @document.id,
       :html => '<body id="node_0"><p id="node_2" line_id="" changed="1" active="true" class="outline_node" parent="node_0">a</p><p id="node_22" line_id="" changed="1" active="true" class="outline_node" parent="node_0">a</p><p line_id="" changed="1" active="true" class="outline_node" id="node_3" parent="node_0">b</p><p line_id="" active="true" changed="1" class="outline_node" id="node_4" parent="node_0">c</p><ul changed="1"><li line_id="" changed="1" active="true" class="outline_node" id="node_5" parent="node_0">1<ul><li line_id="" active="true" changed="1" class="outline_node" id="node_6" parent="node_5">2<ul><li line_id="" changed="1" class="outline_node" id="node_7" parent="node_6">3</li></ul></li></ul></li></ul></body>',
       :name => 'untitled',
       :delete_nodes => nil,
       :new_nodes => 'true'}
    lines = Line.find_all_by_document_id(@document.id)
    assert(lines.length == 5)
    @document = Document.update(add_node_request, @user_id)
    lines = Line.find_all_by_document_id(@document.id)
    assert(lines.length == 6)
  end

  test "deactivate" do
    sign_in users(:one)
    request = {
      :delete_nodes=>"",
      :name=>"untitled",
      :html=>'<body id="node_0"><p id="node_2" line_id="" changed="1" active="false" class="outline_node" parent="node_0">a</p><p line_id="" changed="1" active="true" class="outline_node" id="node_3" parent="node_0">b</p><p line_id="" active="true" changed="1" class="outline_node" id="node_4" parent="node_0">c</p><ul changed="1"><li line_id="" changed="1" active="true" class="outline_node" id="node_5" parent="node_0">1<ul><li line_id="" active="true" changed="1" class="outline_node" id="node_6" parent="node_5">2<ul><li line_id="" changed="1" class="outline_node" id="node_7" parent="node_6">3</li></ul></li></ul></li></ul></body>',
      :id=>@document.id,
      :new_nodes=>"true"}
    lines = Line.find_all_by_document_id(@document.id)
    assert(lines.length == 5)
    Document.update(request, 1)
    lines = Line.find_all_by_document_id(@document.id)
    assert(lines.length == 4)
  end

  test "new IE doc" do
    document = Document.create(:user_id => @user_id, :name => 'untitled')
    request = {
       :id => document.id,
       :html => "<BODY id=node_0 line_id=\"413\">\r\n<UL>\r\n<LI id=node_16 class=outline_node line_id changed=\"1\" parent=\"node_0\" active=\"true\">a</LI>\r\n<LI id=node_17 class=outline_node line_id changed=\"1\" parent=\"node_0\" active=\"true\">b \r\n<UL>\r\n<LI id=node_18 class=outline_node line_id changed=\"1\" active=\"true\" parent=\"node_17\">c - d</LI></UL></LI></UL></BODY>",
       :name => 'untitled',
       :delete_nodes => nil,
       :new_nodes => 'true'}
    document = Document.update(request, @user_id)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 3)
  end

  test "error" do
    sign_in users(:one)
    document = Document.create(:user_id => 1, :name => 'untitled')
    request = {
      :delete_nodes=>"",
      :name=>"untitled",
      :html=>"<body line_id=\"30640\" id=\"node_0\"><ul changed=\"1\"><li parent=\"node_0\" class=\"outline_node\" line_id=\"\" changed=\"1\" active=\"true\" id=\"node_373\">a<br><ul changed=\"1\"><li parent=\"node_373\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_470\" active=\"true\"><br><ul changed=\"1\"><li parent=\"\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_471\" active=\"true\"><br><ul><li parent=\"\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_472\" active=\"true\"><br><ul changed=\"1\"><li parent=\"\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_473\" active=\"true\"><br><ul><li parent=\"\" class=\"outline_node\" line_id=\"\" changed=\"1\" id=\"node_474\" active=\"true\">s</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></body>",
      :id=>document.id,
      :new_nodes=>"true"}
    Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 6)
  end

  test "wikipedia" do
    sign_in users(:one)
    document = Document.create(:user_id => 1, :name => 'untitled')
    doc_id = document.id
    request = {
      :delete_nodes=>nil,
      :name=>"untitled",
      :html=>'<body id=\"node_0\"><h1 id=\"\" class=\"firstHeading\" style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0.1em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0px; padding-bottom: 0px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); width: auto; font-size: 1.6em; line-height: 1.2em; background-position: initial initial; background-repeat: initial initial; \"><i>Polyozellus</i></h1><div id=\"\" style=\"font-size: 0.8em; position: relative; width: 1327px; line-height: 1.5em; \"><div id=\"\" style=\"display: inline; font-size: 12px; font-weight: normal; \">From Wikipedia, the free encyclopedia</div><div id=\"\" style=\"font-size: 10px; line-height: 1.2em; margin-top: 0px; margin-right: 0px; margin-bottom: 1.4em; margin-left: 1em; color: rgb(125, 125, 125); width: auto; \"><br></div><table style=\"font-size: 13px; color: black; float: right; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; background-position: initial initial; background-repeat: initial initial; \" class=\" cke_show_border\"><tbody><tr><td><div><table class=\"infobox biota cke_show_border\" style=\"font-size: 13px; color: black; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(170, 170, 170); border-right-color: rgb(170, 170, 170); border-bottom-color: rgb(170, 170, 170); border-left-color: rgb(170, 170, 170); background-color: rgb(249, 249, 249); margin-top: 0.5em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 1em; padding-top: 0.2em; padding-right: 0.2em; padding-bottom: 0.2em; padding-left: 0.2em; float: right; clear: right; text-align: left; line-height: 1.5em; width: 200px; \"><tbody><tr><th colspan=\"2\" style=\"vertical-align: top; text-align: center; background-color: rgb(173, 216, 230); \"><i>Polyozellus</i></th></tr><tr><td colspan=\"2\" style=\"vertical-align: top; text-align: center; \"><img alt=\"A bluish-purple fungus made of a cluster of fan- or funnel-shaped ruffled segments fused at a common base. Specimen is growing in a bed of green moss.\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Polyozellus_multiplex_34001.jpg/234px-Polyozellus_multiplex_34001.jpg\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Polyozellus_multiplex_34001.jpg/234px-Polyozellus_multiplex_34001.jpg\" width=\"234\" height=\"162\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></td></tr><tr><td colspan=\"2\" style=\"vertical-align: top; text-align: center; font-size: 10px; \"><i>Polyozellus multiplex</i></td></tr><tr><th colspan=\"2\" style=\"vertical-align: top; text-align: center; background-color: rgb(173, 216, 230); \">Scientific classification</th></tr><tr><td style=\"vertical-align: top; \">Kingdom:</td><td style=\"vertical-align: top; \">Fungi</td></tr><tr><td style=\"vertical-align: top; \">Division:</td><td style=\"vertical-align: top; \">Basidiomycota</td></tr><tr><td style=\"vertical-align: top; \">Class:</td><td style=\"vertical-align: top; \">Agaricomycetes</td></tr><tr><td style=\"vertical-align: top; \">Order:</td><td style=\"vertical-align: top; \">Thelephorales</td></tr><tr><td style=\"vertical-align: top; \">Family:</td><td style=\"vertical-align: top; \">Thelephoraceae</td></tr><tr><td style=\"vertical-align: top; \">Genus:</td><td style=\"vertical-align: top; \"><i><b>Polyozellus</b></i><br><small>Murrill&nbsp;(1910)</small></td></tr><tr><td style=\"vertical-align: top; \">Species:</td><td style=\"vertical-align: top; \"><i><b>P. multiplex</b></i></td></tr><tr><th colspan=\"2\" style=\"vertical-align: top; text-align: center; background-color: rgb(173, 216, 230); \">Binomial name</th></tr><tr><td colspan=\"2\" style=\"vertical-align: top; text-align: center; \"><b><i>Polyozellus multiplex</i></b><br><small>(Underw.) Murrill (1910)</small></td></tr><tr><th colspan=\"2\" style=\"vertical-align: top; text-align: center; background-color: rgb(173, 216, 230); \">Synonyms<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[1]</sup></th></tr><tr><td colspan=\"2\" style=\"vertical-align: top; text-align: left; \"><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_2\" line_id=\"\" changed=\"1\" class=\"outline_node\"><i>Cantharellus multiplex</i>&nbsp;<small>Underw.&nbsp;(1899)</small><br><i>Phyllocarbon yasudai</i>&nbsp;<small>Lloyd&nbsp;(1921)</small><br><i>Craterellus multiplex</i>&nbsp;<small>(Underw.)&nbsp;Shope(1938)</small><br><i>Thelephora multiplex</i>&nbsp;<small>(Underw.) S.Kawam. (1954)</small></p></td></tr></tbody></table></div><table class=\"infobox cke_show_border\" cellspacing=\"5\" style=\"font-size: 10px; color: black; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(170, 170, 170); border-right-color: rgb(170, 170, 170); border-bottom-color: rgb(170, 170, 170); border-left-color: rgb(170, 170, 170); background-color: rgb(249, 249, 249); margin-top: 0.5em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 1em; padding-top: 0.2em; padding-right: 0.2em; padding-bottom: 0.2em; padding-left: 0.2em; float: right; clear: right; text-align: left; line-height: 1.5em; width: 22em; \"><tbody><tr><th colspan=\"2\" class=\"\" style=\"vertical-align: top; text-align: center; font-size: 14px; font-weight: bold; background-color: rgb(173, 216, 230); \"><i>Polyozellus multiplex</i></th></tr><tr class=\"\"><td colspan=\"2\" class=\"\" style=\"vertical-align: top; text-align: center; background-color: rgb(173, 216, 230); font-style: italic; font-size: 12px; \"><div class=\"floatright\" style=\"clear: right; float: right; position: relative; margin-top: 0px; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0.5em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; \"><img alt=\"View the Mycomorphbox template that generates the following list\" src=\"http://upload.wikimedia.org/wikipedia/en/thumb/3/35/Information_icon.svg/14px-Information_icon.svg.png\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/en/thumb/3/35/Information_icon.svg/14px-Information_icon.svg.png\" width=\"14\" height=\"14\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></div>Mycological characteristics</td></tr><tr class=\"\"><th scope=\"row\" style=\"vertical-align: top; text-align: left; white-space: nowrap; \"><img alt=\"\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/c/c6/Ridges_icon.png/30px-Ridges_icon.png\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/c/c6/Ridges_icon.png/30px-Ridges_icon.png\" width=\"30\" height=\"30\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></th><td class=\"\" style=\"vertical-align: top; text-align: right; \"><b>ridges</b>&nbsp;on hymenium</td></tr><tr class=\"\"><th scope=\"row\" style=\"vertical-align: top; text-align: left; white-space: nowrap; \"><img alt=\"\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Infundibuliform_cap_icon.svg/30px-Infundibuliform_cap_icon.svg.png\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Infundibuliform_cap_icon.svg/30px-Infundibuliform_cap_icon.svg.png\" width=\"30\" height=\"30\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></th><td class=\"\" style=\"vertical-align: top; text-align: right; \">cap is&nbsp;<b>infundibuliform</b></td></tr><tr class=\"\"><th scope=\"row\" style=\"vertical-align: top; text-align: left; white-space: nowrap; \"><img alt=\"\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/NA_cap_icon.svg/30px-NA_cap_icon.svg.png\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/NA_cap_icon.svg/30px-NA_cap_icon.svg.png\" width=\"30\" height=\"30\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></th><td class=\"\" style=\"vertical-align: top; text-align: right; \">hymenium attachment is irregular or not applicable</td></tr><tr class=\"\"><th scope=\"row\" style=\"vertical-align: top; text-align: left; white-space: nowrap; \"><img alt=\"\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/4/49/Bare_stipe_icon.png/30px-Bare_stipe_icon.png\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/4/49/Bare_stipe_icon.png/30px-Bare_stipe_icon.png\" width=\"30\" height=\"30\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></th><td class=\"\" style=\"vertical-align: top; text-align: right; \">stipe is&nbsp;<b>bare</b></td></tr><tr class=\"\"><th scope=\"row\" style=\"vertical-align: top; text-align: left; white-space: nowrap; \"><img alt=\"\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/White_spore_print_icon.png/30px-White_spore_print_icon.png\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/White_spore_print_icon.png/30px-White_spore_print_icon.png\" width=\"30\" height=\"30\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></th><td class=\"\" style=\"vertical-align: top; text-align: right; \">spore print is&nbsp;<b>white</b></td></tr><tr class=\"\"><th scope=\"row\" style=\"vertical-align: top; text-align: left; white-space: nowrap; \"><img alt=\"\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Mycorrhizal_ecology_icon.png/30px-Mycorrhizal_ecology_icon.png\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Mycorrhizal_ecology_icon.png/30px-Mycorrhizal_ecology_icon.png\" width=\"30\" height=\"30\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></th><td class=\"\" style=\"vertical-align: top; text-align: right; \">ecology is&nbsp;<b>mycorrhizal</b></td></tr><tr class=\"\"><th scope=\"row\" style=\"vertical-align: top; text-align: left; white-space: nowrap; \"><img alt=\"\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Edible_toxicity_icon.svg/30px-Edible_toxicity_icon.svg.png\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Edible_toxicity_icon.svg/30px-Edible_toxicity_icon.svg.png\" width=\"30\" height=\"30\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></th><td class=\"\" style=\"vertical-align: top; text-align: right; \">edibility:&nbsp;<b>edible</b></td></tr></tbody></table></td></tr></tbody></table><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_3\" line_id=\"40134\" changed=\"1\" class=\"outline_node\" active=\"true\"><i><b>Polyozellus</b></i>&nbsp;is a fungal&nbsp;genus&nbsp;in the&nbsp;family&nbsp;Thelephoraceae, a grouping of&nbsp;mushrooms&nbsp;known collectively as the&nbsp;leathery earthfans. A&nbsp;monotypic&nbsp;genus, it contains the single species<i><b>Polyozellus multiplex</b></i>, first described in 1899, and&nbsp;commonly&nbsp;known as the&nbsp;<b>blue chanterelle</b>, the&nbsp;<b>clustered blue chanterelle</b>, or, in&nbsp;Alaska, the&nbsp;<b>black chanterelle</b>. The distinctive&nbsp;fruit body&nbsp;of this species comprises blue- to purple-colored clusters of vase- or spoon-shaped&nbsp;caps&nbsp;with veiny wrinkles on the undersurface that run down the length of the&nbsp;stem.</p><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_4\" line_id=\"\" changed=\"1\" class=\"outline_node\"><i>Polyozellus</i>&nbsp;has had a varied&nbsp;taxonomic&nbsp;history and has been&nbsp;reclassified&nbsp;several times at both the&nbsp;family&nbsp;and genus level. The&nbsp;range&nbsp;of&nbsp;<i>Polyozellus</i>&nbsp;includes North America and eastern Asia, where&nbsp;<i>P.&nbsp;multiplex</i>&nbsp;may be found growing on the ground in&nbsp;coniferous forests, usually under&nbsp;spruce&nbsp;and&nbsp;fir&nbsp;trees. It is an&nbsp;edible&nbsp;species, and has been harvested for commercial purposes.&nbsp;<i>Polyozellus multiplex</i>&nbsp;contains the&nbsp;bioactive&nbsp;compound&nbsp;polyozellin, shown to have various&nbsp;physiological&nbsp;properties, including suppressive effects on&nbsp;stomach cancer.</p><table id=\"\" class=\"toc cke_show_border\" style=\"font-size: 12px; color: black; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(170, 170, 170); border-right-color: rgb(170, 170, 170); border-bottom-color: rgb(170, 170, 170); border-left-color: rgb(170, 170, 170); background-color: rgb(249, 249, 249); padding-top: 5px; padding-right: 5px; padding-bottom: 5px; padding-left: 5px; \"><tbody><tr><td><div id=\"\" style=\"text-align: center; \"><h2 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: bold; margin-top: 0px; margin-right: 0px; margin-bottom: 0.6em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0px; padding-bottom: 0px; border-bottom-style: none; width: auto; font-size: 12px; display: inline; border-top-style: none; border-right-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-right: 0px; padding-left: 0px; border-width: initial; border-color: initial; background-position: initial initial; background-repeat: initial initial; \">Contents</h2>&nbsp;[hide]</div><ul style=\"line-height: 1.5em; list-style-type: none; margin-top: 0.3em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; list-style-image: none; text-align: left; \"><li class=\"toclevel-1 tocsection-1 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_5\" line_id=\"\" changed=\"1\">1&nbsp;History and taxonomy</li><li class=\"toclevel-1 tocsection-2 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_6\" line_id=\"\" changed=\"1\">2&nbsp;Description<ul style=\"line-height: 1.5em; list-style-type: none; margin-top: 0px; margin-right: 0px; margin-bottom: 0.5em; margin-left: 2em; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; list-style-image: none; text-align: left; \"><li class=\"toclevel-2 tocsection-3 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_7\" line_id=\"\" changed=\"1\">2.1&nbsp;Microscopic characteristics</li><li class=\"toclevel-2 tocsection-4 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_8\" line_id=\"\" changed=\"1\">2.2&nbsp;Similar species</li></ul></li><li class=\"toclevel-1 tocsection-5 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_9\" line_id=\"\" changed=\"1\">3&nbsp;Habitat and distribution</li><li class=\"toclevel-1 tocsection-6 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_10\" line_id=\"\" changed=\"1\">4&nbsp;Uses<ul style=\"line-height: 1.5em; list-style-type: none; margin-top: 0px; margin-right: 0px; margin-bottom: 0.5em; margin-left: 2em; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; list-style-image: none; text-align: left; \"><li class=\"toclevel-2 tocsection-7 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_11\" line_id=\"\" changed=\"1\">4.1&nbsp;Edibility</li><li class=\"toclevel-2 tocsection-8 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_12\" line_id=\"\" changed=\"1\">4.2&nbsp;Bioactive compounds</li><li class=\"toclevel-2 tocsection-9 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_13\" line_id=\"\" changed=\"1\">4.3&nbsp;Antitumor properties</li></ul></li><li class=\"toclevel-1 tocsection-10 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_14\" line_id=\"\" changed=\"1\">5&nbsp;See also</li><li class=\"toclevel-1 tocsection-11 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_15\" line_id=\"\" changed=\"1\">6&nbsp;References</li><li class=\"toclevel-1 tocsection-12 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_16\" line_id=\"\" changed=\"1\">7&nbsp;Cited literature</li><li class=\"toclevel-1 tocsection-13 outline_node\" style=\"margin-bottom: 0.1em; \" id=\"node_17\" line_id=\"\" changed=\"1\">8&nbsp;External links</li></ul></td></tr></tbody></table><h2 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0.6em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); width: auto; font-size: 19px; background-position: initial initial; background-repeat: initial initial; \">[edit]History and taxonomy</h2><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_18\" line_id=\"\" changed=\"1\" class=\"outline_node\">The first published&nbsp;description&nbsp;of the species was written by botanist&nbsp;Lucien M. Underwood&nbsp;in 1899, based on a specimen found the previous year in the woods of&nbsp;Mount Desert, Maine. Although he called the new species a&nbsp;<i>Cantharellus</i>, he noted that \"the plant is a remarkable one and from its habit might well form a distinct genus since it has little in common with<i>Cantharellus</i>&nbsp;except its fold-like gills.\"<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[2]</sup>&nbsp;In 1910,&nbsp;William Murrill&nbsp;transferred it to the new genus&nbsp;<i>Polyozellus</i>; Murrill thought the compound structure of the stem to be a sufficiently unique characteristic to warrant it being separated from&nbsp;<i>Cantharellus</i>&nbsp;species, which have simpler stem structures.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[3]</sup>&nbsp;In 1920, specimens from a Japanese collection compiled by A.&nbsp;Yasuda were sent to mycologist&nbsp;Curtis Gates Lloyd, who believed the fungus to be a new species and named it&nbsp;<i>Phyllocarbon yasudai</i>.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[4]</sup></p><div class=\"thumb tleft\" style=\"margin-bottom: 1.3em; width: auto; background-color: transparent; float: left; clear: left; margin-top: 0.5em; margin-right: 1.4em; margin-left: 0px; \"><div class=\"thumbinner\" style=\"min-width: 100px; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; background-color: rgb(249, 249, 249); font-size: 12px; text-align: center; overflow-x: hidden; overflow-y: hidden; width: 222px; \"><img alt=\"A light brown fungus made of a cluster of several funnel-shaped ruffled segments fused at a common base, growing on the forest floor.\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Gomphus_clavatus1.jpg/220px-Gomphus_clavatus1.jpg\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Gomphus_clavatus1.jpg/220px-Gomphus_clavatus1.jpg\" width=\"220\" height=\"165\" class=\"thumbimage\" style=\"border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-width: initial; border-color: initial; vertical-align: middle; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); \"><div class=\"thumbcaption\" style=\"text-align: left; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; line-height: 1.4em; padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; font-size: 10px; \"><div class=\"magnify\" style=\"float: right; border-top-style: none !important; border-right-style: none !important; border-bottom-style: none !important; border-left-style: none !important; border-width: initial !important; border-color: initial !important; background-image: none !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; \"><img src=\"http://bits.wikimedia.org/skins-1.17/common/images/magnify-clip.png\" data-cke-saved-src=\"http://bits.wikimedia.org/skins-1.17/common/images/magnify-clip.png\" width=\"15\" height=\"11\" alt=\"\" style=\"border-top-style: none !important; border-right-style: none !important; border-bottom-style: none !important; border-left-style: none !important; border-width: initial; border-color: initial; vertical-align: middle; display: block; border-width: initial !important; border-color: initial !important; background-image: none !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; \"></div><i>Polyozellus multiplex</i>&nbsp;was once considered to be an extreme&nbsp;growth formof&nbsp;<i>Gomphus clavatus</i>, shown here.</div></div></div><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_19\" line_id=\"\" changed=\"1\" class=\"outline_node\">No further collections of the fungus were reported until 1937, when it was found in&nbsp;Quebec, Canada.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[5]</sup>&nbsp;The next year, Paul Shope considered the genus&nbsp;<i>Polyozellus</i>&nbsp;to be superfluous, pointed out that the compound&nbsp;fruit bodies&nbsp;and the wrinkled&nbsp;hymenium&nbsp;were instead consistent with the genus&nbsp;<i>Craterellus</i>.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[6]</sup>&nbsp;In 1939, American mycologist&nbsp;Lee Overholts, in a letter to the journal&nbsp;<i>Mycologia</i>, opined that both of these authors had overlooked a 1925 publication by&nbsp;Calvin Kauffman, who made notes and photos of the species collected in the&nbsp;Rocky Mountains&nbsp;of&nbsp;Wyomingand&nbsp;Colorado, and in the&nbsp;Cascade Mountains&nbsp;of&nbsp;Washington&nbsp;and&nbsp;Oregon.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[7]</sup>&nbsp;Kauffman believed the species to be merely \"a very extreme growth condition\" of&nbsp;<i>Cantharellus clavatus</i>&nbsp;(now known as&nbsp;<i>Gomphus clavatus</i>) and suggested there was no reason for transferring the species to the genus&nbsp;<i>Craterellus</i>.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[8]</sup>&nbsp;Mycologists&nbsp;Alexander H.&nbsp;Smith&nbsp;and Elizabeth Morse, in their 1947 publication on&nbsp;<i>Cantharellus</i>&nbsp;species in the United States, placed the species in a new section&nbsp;<i>Polyozellus</i>, but did not separate it from the genus&nbsp;<i>Cantharellus</i>; they defined the distinguishing characteristics of&nbsp;<i>Polyozellus</i>&nbsp;as the small, roughened,&nbsp;hyaline&nbsp;spores and the color change of the flesh in&nbsp;potassium hydroxidesolution, adding that \"the spores are unusual for the genus but in our estimation do not warrant excluding the species.\"<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[9]</sup></p><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_20\" line_id=\"\" changed=\"1\" class=\"outline_node\">In 1953, Rokuya Imazeki took into consideration differences in&nbsp;spore&nbsp;characteristics: species in the genus&nbsp;<i>Cantharellus</i>&nbsp;were not known to have spores that were subglobose (roughly spherical) and tuberculate (covered with wart-like projections) like&nbsp;<i>Polyozellus</i>; however, these spore characteristics were common in species in the Thelephoraceae family (<i>Cantharellus</i>&nbsp;belongs in a different family, the&nbsp;Cantharellaceae). Other characteristics linking the blue chanterelle with the Thelephoraceae included the dark color, the strong odor (especially in dried specimens), and the presence of&nbsp;thelephoric acid, a mushroom&nbsp;pigment&nbsp;common in the family. Taken together, these factors led Imazeki to propose the new family Phylacteriaceae.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[10]</sup>&nbsp;The suggested family-level&nbsp;taxonomical&nbsp;change was not accepted by other authors; for example, in 1954, Seiichi Kawamura renamed it&nbsp;<i>Thelephora multiplex</i>.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[11]</sup>&nbsp;As of 2009, both&nbsp;Index Fungorum<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[12]</sup>&nbsp;and&nbsp;MycoBank<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[13]</sup>&nbsp;list&nbsp;<i>Polyozellus</i>&nbsp;as being within the Thelephoraceae family, a grouping of mushrooms commonly known as the&nbsp;leathery earthfans.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[14]</sup>&nbsp;The genus name is derived from the&nbsp;Greek&nbsp;<i>poly</i>&nbsp;meaning&nbsp;<i>many</i>, and&nbsp;<i>oz</i>, meaning&nbsp;<i>branch</i>.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[15]</sup>&nbsp;The&nbsp;specific name&nbsp;<i>multiplex</i>&nbsp;means \"in many pieces\", referring to the compound nature of the fruit body.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[16]</sup>&nbsp;Common names&nbsp;for this species include the blue chanterelle and the clustered blue chanterelle.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[17]</sup>&nbsp;In&nbsp;Alaska, where specimens typically have very dark-colored fruit bodies, it is called the black chanterelle,<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[18]</sup>&nbsp;although this name is shared with some&nbsp;<i>Craterellus</i>&nbsp;species.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[19]</sup></p><h2 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0.6em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); width: auto; font-size: 19px; background-position: initial initial; background-repeat: initial initial; \">[edit]Description</h2><div class=\"thumb tleft\" style=\"margin-bottom: 1.3em; width: auto; background-color: transparent; float: left; clear: left; margin-top: 0.5em; margin-right: 1.4em; margin-left: 0px; \"><div class=\"thumbinner\" style=\"min-width: 100px; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; background-color: rgb(249, 249, 249); font-size: 12px; text-align: center; overflow-x: hidden; overflow-y: hidden; width: 222px; \"><img alt=\"A light blue fungus made of a cluster of fan- or funnel-shaped ruffled segments fused at a common base, growing on the ground\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Polyozellus_multiplex_23792.jpg/220px-Polyozellus_multiplex_23792.jpg\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Polyozellus_multiplex_23792.jpg/220px-Polyozellus_multiplex_23792.jpg\" width=\"220\" height=\"240\" class=\"thumbimage\" style=\"border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-width: initial; border-color: initial; vertical-align: middle; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); \"><div class=\"thumbcaption\" style=\"text-align: left; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; line-height: 1.4em; padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; font-size: 10px; \"><div class=\"magnify\" style=\"float: right; border-top-style: none !important; border-right-style: none !important; border-bottom-style: none !important; border-left-style: none !important; border-width: initial !important; border-color: initial !important; background-image: none !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; \"><img src=\"http://bits.wikimedia.org/skins-1.17/common/images/magnify-clip.png\" data-cke-saved-src=\"http://bits.wikimedia.org/skins-1.17/common/images/magnify-clip.png\" width=\"15\" height=\"11\" alt=\"\" style=\"border-top-style: none !important; border-right-style: none !important; border-bottom-style: none !important; border-left-style: none !important; border-width: initial; border-color: initial; vertical-align: middle; display: block; border-width: initial !important; border-color: initial !important; background-image: none !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; \"></div>Specimen from&nbsp;Lake Wenatchee&nbsp;area, Washington State, US</div></div></div><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_21\" line_id=\"40135\" changed=\"1\" class=\"outline_node\" active=\"true\"><i>Polyozellus multiplex</i>&nbsp;is part of the group of fungi collectively known as cantharelloid mushrooms (which includes the genera&nbsp;<i>Cantharellus</i>,&nbsp;<i>Craterellus</i>,&nbsp;<i>Gomphus</i>, and&nbsp;<i>Polyozellus</i>) because of the similarity of their&nbsp;fruit body&nbsp;structures and the&nbsp;morphology&nbsp;of the spore-producing region (the&nbsp;hymenophore) on the underside of the caps.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[15]</sup>&nbsp;The fan- or funnel-shaped fruit bodies of the black chanterelle grow clustered together on the ground, often in large masses that may reach aggregate diameters of up to 1&nbsp;meter (3.3&nbsp;ft),<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[6]</sup><sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[9]</sup>&nbsp;although they are usually up to 30&nbsp;centimeters (11.8&nbsp;in).<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[20]</sup></p><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_22\" line_id=\"\" changed=\"1\" class=\"outline_node\">The individual&nbsp;caps, 3–5 cm (1.2–2.0 in) wide and almost as long, are violet-black, with edges that are initially whitish, and with a&nbsp;glaucous&nbsp;surface—a white powdery accumulation of spore deposit.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[2]</sup>&nbsp;The upper surface may be&nbsp;zonate—lined with what appear to be multiple concentric zones of texture caused by areas of fine hairs (a&nbsp;tomentum); and the edges of the caps have a layer of very fine hairs and are lobed and wavy. The underside of the caps bears the fertile, spore-making tissue called the&nbsp;hymenium, which typically has shallow, crowded wrinkles or veins that are roughly the same color or paler than the top surface.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[21]</sup>&nbsp;Some variation in color has been observed depending on the collection location. For example, specimens found in Alaska are more likely to be jet-black in color with a dark gray underside.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[19]</sup></p><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_23\" line_id=\"\" changed=\"1\" class=\"outline_node\">Fruit bodies may be up to 15&nbsp;cm (5.9&nbsp;in) high (including the stem) and 10&nbsp;cm (3.9&nbsp;in) wide. Occasionally, much larger clusters of fused mushrooms are found, up to a meter in diameter.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[22]</sup>The&nbsp;stem&nbsp;is dark purplish-black with a smooth (glabrous) and dry surface; the stems are often fused at the base. It is typically 1.5–2 cm (0.6–0.8 in) wide and up to 5&nbsp;cm (2.0&nbsp;in) long. The&nbsp;fleshis dark violet, soft but breaking easily. The&nbsp;spore deposit&nbsp;is white.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[23]</sup></p><h3 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: bold; margin-top: 0px; margin-right: 0px; margin-bottom: 0.3em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: initial; border-bottom-style: none; border-bottom-color: initial; width: auto; font-size: 16px; background-position: initial initial; background-repeat: initial initial; \">[edit]Microscopic characteristics</h3><div class=\"thumb tright\" style=\"margin-bottom: 1.3em; width: auto; background-color: transparent; clear: right; float: right; margin-top: 0.5em; margin-right: 0px; margin-left: 1.4em; \"><div class=\"thumbinner\" style=\"min-width: 100px; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; background-color: rgb(249, 249, 249); font-size: 12px; text-align: center; overflow-x: hidden; overflow-y: hidden; width: 222px; \"><img alt=\"A fungus made of two dark brown funnel-shaped shapes with black rims, joined at a common base, surrounded by green moss\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Craterellus_cornucopiodes_12457.jpg/220px-Craterellus_cornucopiodes_12457.jpg\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Craterellus_cornucopiodes_12457.jpg/220px-Craterellus_cornucopiodes_12457.jpg\" width=\"220\" height=\"178\" class=\"thumbimage\" style=\"border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-width: initial; border-color: initial; vertical-align: middle; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); \"><div class=\"thumbcaption\" style=\"text-align: left; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; line-height: 1.4em; padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; font-size: 10px; \"><div class=\"magnify\" style=\"float: right; border-top-style: none !important; border-right-style: none !important; border-bottom-style: none !important; border-left-style: none !important; border-width: initial !important; border-color: initial !important; background-image: none !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; \"><img src=\"http://bits.wikimedia.org/skins-1.17/common/images/magnify-clip.png\" data-cke-saved-src=\"http://bits.wikimedia.org/skins-1.17/common/images/magnify-clip.png\" width=\"15\" height=\"11\" alt=\"\" style=\"border-top-style: none !important; border-right-style: none !important; border-bottom-style: none !important; border-left-style: none !important; border-width: initial; border-color: initial; vertical-align: middle; display: block; border-width: initial !important; border-color: initial !important; background-image: none !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; \"></div><i>Craterellus cornucopioides</i>, a lookalike species</div></div></div><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_24\" line_id=\"\" changed=\"1\" class=\"outline_node\">The&nbsp;spores&nbsp;are roughly spherical to broadly&nbsp;ellipsoid&nbsp;in shape, covered with small wart-like projections (tubercules), and have dimensions of 6–8.5 by 5.5–8&nbsp;µm.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[23]</sup>&nbsp;Viewed microscopically, they are&nbsp;hyaline, meaning they appear translucent or colorless. Chemical tests may also be used to help distinguish the spores: in the presence of&nbsp;potassium hydroxide&nbsp;(KOH), the spores turn slightly green; the spores are not&nbsp;amyloid, meaning they do not take&nbsp;iodine&nbsp;when treated with&nbsp;Melzer\'s reagent; the spores are acyanophilous, meaning they do not readily absorb&nbsp;methyl blue&nbsp;stain. The&nbsp;cystidia&nbsp;that comprise the&nbsp;hymenium&nbsp;are&nbsp;filamentous&nbsp;and 3–4&nbsp;µm wide by 28–40&nbsp;µm long. The outer tissue layer of the cap—the cuticle, or&nbsp;pileipellis—is made of interwoven&nbsp;hyphae, and stains olive-green in KOH.&nbsp;Clamp connections&nbsp;are present, but not at all the&nbsp;cell partitions.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[24]</sup>The&nbsp;basidia, the spore-bearing cells, are 32–38 by 5–6&nbsp;µm and four-spored.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[9]</sup></p><h3 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: bold; margin-top: 0px; margin-right: 0px; margin-bottom: 0.3em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: initial; border-bottom-style: none; border-bottom-color: initial; width: auto; font-size: 16px; background-position: initial initial; background-repeat: initial initial; \">[edit]Similar species</h3><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_25\" line_id=\"40136\" changed=\"1\" class=\"outline_node\" active=\"true\">The horn-of-plenty mushroom (<i>Craterellus cornucopioides</i>) also has a blackish fruit body and a smooth hymenium, but is distinguished from&nbsp;<i>P.&nbsp;multiplex</i>&nbsp;by its thin flesh, a trumpet- or tubular-shaped fruit body (rather than fan- or spoon-shaped), and grey to black colors. A closely related species, the fragrant chanterelle (<i>Cantharellus odoratus</i>), also tends to grow in dense clusters, but it is orange rather than blue.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[25]</sup>&nbsp;<i>Craterellus caeruleofuscus</i>&nbsp;does not form compound clusters, and is not restricted to coniferous forests.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[20]</sup>&nbsp;The pig\'s ear Gomphus, species<i>Gomphus clavatus</i>, is similar in shape and form but fleshier, and light violet to pink.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[14]</sup></p><h2 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0.6em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); width: auto; font-size: 19px; background-position: initial initial; background-repeat: initial initial; \">[edit]Habitat and distribution</h2><div class=\"thumb tright\" style=\"margin-bottom: 1.3em; width: 241px; background-color: transparent; clear: right; float: right; margin-top: 0.5em; margin-right: 0px; margin-left: 1.4em; \"><div class=\"thumbinner\" style=\"min-width: 100px; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; background-color: rgb(249, 249, 249); font-size: 12px; text-align: center; overflow-x: hidden; overflow-y: hidden; \"><div style=\"float: left; margin-top: 1px; margin-right: 1px; margin-bottom: 1px; margin-left: 1px; width: 107px; \"><div class=\"thumbimage\" style=\"border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); \"><img alt=\"\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Picea_glauca_tree.jpg/105px-Picea_glauca_tree.jpg\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Picea_glauca_tree.jpg/105px-Picea_glauca_tree.jpg\" width=\"105\" height=\"160\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></div></div><div style=\"float: left; margin-top: 1px; margin-right: 1px; margin-bottom: 1px; margin-left: 1px; width: 122px; \"><div class=\"thumbimage\" style=\"border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); \"><img alt=\"\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/7/78/SubalpineFir_7458.jpg/120px-SubalpineFir_7458.jpg\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/7/78/SubalpineFir_7458.jpg/120px-SubalpineFir_7458.jpg\" width=\"120\" height=\"160\" style=\"border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; vertical-align: middle; \"></div></div><div class=\"thumbcaption\" style=\"text-align: left; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; line-height: 1.4em; padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; font-size: 10px; clear: left; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; background-position: initial initial; background-repeat: initial initial; \"><i>Polyozellus</i>&nbsp;grows in a&nbsp;mycorrhizalassociation with conifers like&nbsp;spruce<i>(example left)</i>&nbsp;and&nbsp;fir&nbsp;<i>(right)</i>.</div></div></div><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_26\" line_id=\"\" changed=\"1\" class=\"outline_node\"><i>Polyozellus multiplex</i>&nbsp;is an&nbsp;ectomycorrhizal&nbsp;species, meaning that the&nbsp;hyphae&nbsp;of the fungus grow in a&nbsp;mutualistic&nbsp;association with the roots of plants, but the fungal hyphae generally do not penetrate the cells of the plant\'s roots.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[26]</sup><sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[27]</sup>&nbsp;The species grows in&nbsp;coniferous woods&nbsp;under&nbsp;spruce&nbsp;and&nbsp;fir,<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[22]</sup>&nbsp;and more frequently at higher elevations.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[17]</sup>&nbsp;It is most often encountered in summer and fall.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[24]</sup></p><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_27\" line_id=\"\" changed=\"1\" class=\"outline_node\">This species is northern and&nbsp;alpine&nbsp;in distribution, and rarely encountered. Collections have been made in the United States (including&nbsp;Maine,&nbsp;Oregon,&nbsp;Colorado,&nbsp;New Mexico, and Alaska), Canada (Quebec&nbsp;and&nbsp;British Columbia),<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[21]</sup><sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[5]</sup><sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[9]</sup><sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[28]</sup>&nbsp;China,<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[29]</sup>&nbsp;Japan, and Korea.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[30]</sup>&nbsp;The&nbsp;disjunct distribution&nbsp;of this species in North America and East Asia has been noted to occur in a number of other fungal species as well.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[31]</sup>&nbsp;<i>Polyozellus multiplex</i>&nbsp;is also found in the&nbsp;Queen Charlotte Islands, where it is commercially harvested.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[32]</sup></p><h2 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0.6em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); width: auto; font-size: 19px; background-position: initial initial; background-repeat: initial initial; \">[edit]Uses</h2><h3 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: bold; margin-top: 0px; margin-right: 0px; margin-bottom: 0.3em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: initial; border-bottom-style: none; border-bottom-color: initial; width: auto; font-size: 16px; background-position: initial initial; background-repeat: initial initial; \">[edit]Edibility</h3><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_28\" line_id=\"\" changed=\"1\" class=\"outline_node\"><i>Polyozellus multiplex</i>&nbsp;is&nbsp;edible,<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[33]</sup>&nbsp;and is collected for sale in Asian countries such as Korea, Japan, and China.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[29]</sup>&nbsp;In North America, it is sometimes collected recreationally,<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[34]</sup>&nbsp;and commercially.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[35]</sup>&nbsp;The taste is described as mild, and the odor as mild or aromatic.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[36]</sup>&nbsp;Mycologist&nbsp;David Arora&nbsp;claims the flavor to be inferior to&nbsp;<i>Craterellus</i>.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[21]</sup>&nbsp;Fruit bodies may be preserved by drying.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[22]</sup></p><h3 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: bold; margin-top: 0px; margin-right: 0px; margin-bottom: 0.3em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: initial; border-bottom-style: none; border-bottom-color: initial; width: auto; font-size: 16px; background-position: initial initial; background-repeat: initial initial; \">[edit]Bioactive compounds</h3><div class=\"thumb tright\" style=\"margin-bottom: 1.3em; width: auto; background-color: transparent; clear: right; float: right; margin-top: 0.5em; margin-right: 0px; margin-left: 1.4em; \"><div class=\"thumbinner\" style=\"min-width: 100px; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; background-color: rgb(249, 249, 249); font-size: 12px; text-align: center; overflow-x: hidden; overflow-y: hidden; width: 222px; \"><img alt=\"6,12-diacetoxy-2,3,8,9-tetrahydroxybenzo[1,2-b;4,5-b\']bisbenzofuran\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Polyozellin.svg/220px-Polyozellin.svg.png\" data-cke-saved-src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Polyozellin.svg/220px-Polyozellin.svg.png\" width=\"220\" height=\"145\" class=\"thumbimage\" style=\"border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-width: initial; border-color: initial; vertical-align: middle; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-color: rgb(204, 204, 204); border-right-color: rgb(204, 204, 204); border-bottom-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); \"><div class=\"thumbcaption\" style=\"text-align: left; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; line-height: 1.4em; padding-top: 3px !important; padding-right: 3px !important; padding-bottom: 3px !important; padding-left: 3px !important; font-size: 10px; \"><div class=\"magnify\" style=\"float: right; border-top-style: none !important; border-right-style: none !important; border-bottom-style: none !important; border-left-style: none !important; border-width: initial !important; border-color: initial !important; background-image: none !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; \"><img src=\"http://bits.wikimedia.org/skins-1.17/common/images/magnify-clip.png\" data-cke-saved-src=\"http://bits.wikimedia.org/skins-1.17/common/images/magnify-clip.png\" width=\"15\" height=\"11\" alt=\"\" style=\"border-top-style: none !important; border-right-style: none !important; border-bottom-style: none !important; border-left-style: none !important; border-width: initial; border-color: initial; vertical-align: middle; display: block; border-width: initial !important; border-color: initial !important; background-image: none !important; background-attachment: initial !important; background-origin: initial !important; background-clip: initial !important; background-color: initial !important; background-position: initial initial !important; background-repeat: initial initial !important; \"></div>Skeletal formula&nbsp;of polyozellin<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[37]</sup></div></div></div><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_29\" line_id=\"40137\" changed=\"1\" class=\"outline_node\" active=\"true\">The compound&nbsp;polyozellin—a chemical which can be isolated and purified from&nbsp;<i>P.&nbsp;multiplex</i>—inhibits&nbsp;prolyl endopeptidase&nbsp;(PEP), an&nbsp;enzyme&nbsp;that has a role in processing proteins (specifically,&nbsp;amyloid precursor protein) in&nbsp;Alzheimer\'s disease. Chemicals that inhibit PEP have attracted research interest due to their potential therapeutic effects.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[37]</sup>&nbsp;Further analyses of extracts from&nbsp;<i>P.&nbsp;multiplex</i>&nbsp;revealed similar&nbsp;dibenzofuranyl&nbsp;derivatives&nbsp;of polyozellin, each with different&nbsp;chemical properties, including&nbsp;kynapcin-12,<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[38]</sup>&nbsp;kynapcin-13 and -28,<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[39]</sup>&nbsp;and -24.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[40]</sup>&nbsp;Atotal synthesis&nbsp;of kynapcin-24 was achieved in 2009.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[41]</sup></p><h3 style=\"color: black; background-image: none; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: initial; font-weight: bold; margin-top: 0px; margin-right: 0px; margin-bottom: 0.3em; margin-left: 0px; overflow-x: hidden; overflow-y: hidden; padding-top: 0.5em; padding-bottom: 0.17em; border-bottom-width: initial; border-bottom-style: none; border-bottom-color: initial; width: auto; font-size: 16px; background-position: initial initial; background-repeat: initial initial; \">[edit]Antitumor properties</h3><p style=\"margin-top: 0.4em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; line-height: 1.5em; \" id=\"node_30\" line_id=\"\" changed=\"1\" class=\"outline_node\">Research conducted in 2003 suggests that extracts from&nbsp;<i>Polyozellus multiplex</i>&nbsp;may have suppressive effects on&nbsp;stomach cancer.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[29]</sup><sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[42]</sup>&nbsp;The study showed that feeding a low concentration (0.5% or 1%) of the mushroom extract enhanced the&nbsp;activities&nbsp;of the enzymes&nbsp;glutathione S-transferase&nbsp;and&nbsp;superoxide dismutase, and increased the abundance of the molecule&nbsp;glutathione. The extract also augmented the&nbsp;expression&nbsp;of the protein&nbsp;p53. All of these substances protect the human organism against cancer.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[29]</sup>&nbsp;Additional studies reported in 2004 and 2006 attribute anti-tumor properties to polyozellin.<sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[43]</sup><sup id=\"\" class=\"reference\" style=\"line-height: 1em; font-weight: normal; font-style: normal; \">[44]</sup></p></div><p></p></body>',
      :id=>document.id,
      :new_nodes=>"true"}
    Document.update(request, 1)
    lines = Line.find_all_by_document_id(doc_id)
    assert(lines.length == 4)
  end

  test "sequence 1" do
    sign_in users(:one)

    document = Document.create(:user_id => 1, :name => 'untitled')
    request = { :html=>"<body id=\"node_0\"><p changed=\"1\" id=\"node_2\" line_id=\"\" class=\"outline_node\" active=\"true\" parent=\"node_0\">yo - asdf</p><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_3\" parent=\"node_0\">asdf</p><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_4\" parent=\"node_0\">a</p><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_5\" parent=\"node_0\">sdf</p><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_6\" parent=\"node_0\">asdf</p><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_7\" parent=\"node_0\">as</p><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_8\" parent=\"node_0\">df</p><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_9\" parent=\"node_0\">as</p><ul changed=\"1\"><li changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_10\" parent=\"node_0\">dfasd</li><li changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_11\" parent=\"node_0\">fas<ul><li changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_12\" active=\"true\" parent=\"node_11\">as - asdfsad<ul><li changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_13\" active=\"true\" parent=\"node_12\">fas -asdf</li></ul></li></ul></li><li changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_14\" active=\"true\" parent=\"node_0\">df asdf -sa- fsd</li></ul></body>",
                :name=>"test1",
                :id=>document.id,
                :delete_nodes=>"",
                :new_nodes=>"true"}
    updated_doc = Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 4)
    ids = Hash[*updated_doc.lines.map {|line| [line.domid, line.id]}.flatten]


    to_delete = ids["node_14"].to_s
    request = { :html=>"<body id=\"node_0\"><p changed=\"0\" id=\"node_2\" line_id=\"40145\" class=\"outline_node\" active=\"true\" parent=\"node_0\">yo - asdf</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_3\" parent=\"node_0\">asdf</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_4\" parent=\"node_0\">a</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_5\" parent=\"node_0\">sdf</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_6\" parent=\"node_0\">asdf</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_7\" parent=\"node_0\">as</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_8\" parent=\"node_0\">df</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_9\" parent=\"node_0\">as</p><ul changed=\"1\"><li changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_10\" parent=\"node_0\">dfasd</li><li changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_11\" parent=\"node_0\">fas<ul><li changed=\"0\" line_id=\"40146\" class=\"outline_node\" id=\"node_12\" active=\"true\" parent=\"node_11\">as - asdfsad<ul><li changed=\"1\" line_id=\"40147\" class=\"outline_node\" id=\"node_13\" active=\"true\" parent=\"node_12\">fas -asdf</li></ul></li></ul></li></ul></body>",
                :name=>"test1",
                :id=>document.id,
                :delete_nodes=> to_delete,
                :new_nodes=>"true"}
    updated_doc = Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 3)

    request = { :html=>"<body id=\"node_0\"><p changed=\"0\" id=\"node_2\" line_id=\"40145\" class=\"outline_node\" active=\"true\" parent=\"node_0\">yo - asdf</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_3\" parent=\"node_0\">asdf</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_4\" parent=\"node_0\">a</p><ul changed=\"1\"><li changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_5\" parent=\"node_0\" active=\"true\">&nbsp;sdf - s<ul><li changed=\"1\" line_id=\"\" class=\"outline_node\" parent=\"node_5\" id=\"node_16\" active=\"true\">asdf s- s</li></ul></li></ul><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_6\" parent=\"node_0\" active=\"true\">as - df</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_7\" parent=\"node_0\">as</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_8\" parent=\"node_0\">df</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_9\" parent=\"node_0\">as</p><ul changed=\"1\"><li changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_10\" parent=\"node_0\">dfasd</li><li changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_11\" parent=\"node_0\">fas<ul><li changed=\"0\" line_id=\"40146\" class=\"outline_node\" id=\"node_12\" active=\"true\" parent=\"node_11\">as - asdfsad<ul><li changed=\"0\" line_id=\"40147\" class=\"outline_node\" id=\"node_13\" active=\"true\" parent=\"node_12\">fas -asdf</li></ul></li></ul></li></ul></body>",
                :name=>"test1",
                :id=>document.id,
                :delete_nodes=>"",
                :new_nodes=>"true"}
    updated_doc = Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 6)
    ids = Hash[*updated_doc.lines.map {|line| [line.domid, line.id]}.flatten]

    to_delete = ids["node_16"].to_s
    request = { :html=>"<body id=\"node_0\"><p changed=\"0\" id=\"node_2\" line_id=\"40145\" class=\"outline_node\" active=\"true\" parent=\"node_0\">yo - asdf</p><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_3\" parent=\"node_0\">asasdfasdfasdf asdf sdf df</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_4\" parent=\"node_0\">a</p><ul changed=\"1\"><li changed=\"1\" line_id=\"40149\" class=\"outline_node\" id=\"node_5\" parent=\"node_0\" active=\"true\">&nbsp;sdf - s</li></ul><p changed=\"0\" line_id=\"40151\" class=\"outline_node\" id=\"node_6\" parent=\"node_0\" active=\"true\">as - df</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_7\" parent=\"node_0\">as</p><p changed=\"1\" line_id=\"\" class=\"outline_node\" id=\"node_8\" parent=\"node_0\" active=\"true\">df - asdf</p><p changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_9\" parent=\"node_0\">as</p><ul changed=\"1\"><li changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_10\" parent=\"node_0\">dfasd</li><li changed=\"0\" line_id=\"\" class=\"outline_node\" id=\"node_11\" parent=\"node_0\">fas<ul><li changed=\"0\" line_id=\"40146\" class=\"outline_node\" id=\"node_12\" active=\"true\" parent=\"node_11\">as - asdfsad<ul><li changed=\"0\" line_id=\"40147\" class=\"outline_node\" id=\"node_13\" active=\"true\" parent=\"node_12\">fas -asdf</li></ul></li></ul></li></ul></body>",
                :name=>"test1",
                :id=>document.id,
                :delete_nodes=>to_delete,
                :new_nodes=>"true"}
    updated_doc = Document.update(request, 1)
    lines = Line.find_all_by_document_id(document.id)
    assert(lines.length == 6)
    ids = Hash[*updated_doc.lines.map {|line| [line.domid, line.id]}.flatten]
    dom_ids_set = Set.new(ids.keys)
    correct_ids = Set.new(["node_2", "node_12","node_13","node_5","node_8","node_6"])
    assert(dom_ids_set == correct_ids)
  end

  test "activate existing" do
    sign_in users(:one)
    document = Document.create(:user_id => 1, :name => 'untitled')

    request1 = {
      "delete_nodes"=>"",
      "name"=>"lecture 7",
      "html"=>"<body line_id=\"29534\" id=\"node_0\"><ul changed=\"1\"><li id=\"node_2\" line_id=\"29535\" changed=\"0\" class=\"outline_node\" active=\"false\" parent=\"node_0\">learning objectives:<ul changed=\"1\"><li line_id=\"29536\" changed=\"0\" class=\"outline_node\" parent=\"node_2\" id=\"node_4\">write octave function defined by its Taylor series using both a for loop and with vector operations</li><li line_id=\"29537\" changed=\"0\" class=\"outline_node\" parent=\"node_2\" id=\"node_5\">understand time and space trade-offs</li></ul></li><li line_id=\"29538\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_7\" active=\"true\">Tayler formual - f(x) =&nbsp;http://en.wikipedia.org/wiki/Taylor_series<ul changed=\"1\"><li line_id=\"29539\" changed=\"0\" class=\"outline_node\" parent=\"node_7\" id=\"node_9\" active=\"true\">nth der. of exp(n) - exp(n)</li></ul></li><li line_id=\"29540\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_12\" active=\"true\">hold on - plot on top of existing plot</li><li line_id=\"29541\" changed=\"1\" class=\"outline_node\" parent=\"node_0\" id=\"node_13\" active=\"true\">lambda function - exp3 = @(x) myexp(x,3)</li><li line_id=\"29542\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_14\" active=\"true\">bits of precision - error/log(d)</li><li line_id=\"29544\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_16\" active=\"true\">representing double precision in a computer - 1 bit for sign, 11 bits for exponent, 52 bits for the mantissa</li></ul></body>",
      "id"=> document.id,
      "new_nodes"=>"false"}

#    request2 = {
#      "delete_nodes"=>"",
#      "name"=>"lecture 7",
#      "html"=>"<body line_id=\"29534\" id=\"node_0\"><ul changed=\"1\"><li id=\"node_2\" line_id=\"29535\" changed=\"1\" class=\"outline_node\" active=\"true\" parent=\"node_0\">learning- objectives:<ul changed=\"1\"><li line_id=\"29536\" changed=\"0\" class=\"outline_node\" parent=\"node_2\" id=\"node_4\">write octave function defined by its Taylor series using both a for loop and with vector operations</li><li line_id=\"29537\" changed=\"0\" class=\"outline_node\" parent=\"node_2\" id=\"node_5\">understand time and space trade-offs</li></ul></li><li line_id=\"29538\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_7\" active=\"true\">Tayler formual - f(x) =&nbsp;http://en.wikipedia.org/wiki/Taylor_series<ul changed=\"1\"><li line_id=\"29539\" changed=\"0\" class=\"outline_node\" parent=\"node_7\" id=\"node_9\" active=\"true\">nth der. of exp(n) - exp(n)</li></ul></li><li line_id=\"29540\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_12\" active=\"true\">hold on - plot on top of existing plot</li><li line_id=\"29541\" changed=\"1\" class=\"outline_node\" parent=\"node_0\" id=\"node_13\" active=\"true\">lambda function - exp3 = @(x) myexp(x,3)</li><li line_id=\"29542\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_14\" active=\"true\">bits of precision - error/log(d)</li><li line_id=\"29544\" changed=\"0\" class=\"outline_node\" parent=\"node_0\" id=\"node_16\" active=\"true\">representing double precision in a computer - 1 bit for sign, 11 bits for exponent, 52 bits for the mantissa</li></ul></body>",
#      "id"=> document.id,
#      "new_nodes"=>"false"}

    Document.update(request1, 1)
    lines = Line.find_all_by_document_id(document.id)
    puts lines.length
    assert(lines.length == 0)
  end
end
